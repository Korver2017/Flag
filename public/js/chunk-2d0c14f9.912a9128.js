(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0c14f9"],{4601:function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[t.user.authed?[t.avatarHash.length>0?s("img",{staticClass:"rounded-circle mt-5",attrs:{src:"https://www.gravatar.com/avatar/"+t.avatarHash,alt:""}}):t._e(),s("h2",{staticClass:"nav-item nav-link align-right"},[t._v("Hi, "+t._s(t.username)+"!")]),s("h5",[t._v("Welcome to Flag")]),s("div",{staticClass:"container my-5"},[s("div",{staticClass:"row my-5"},[0!==t.orgs.length?s("div",{staticClass:"col-8 mx-auto"},[s("h5",{staticClass:"text-left"},[t._v("My Organizations")]),s("div",{staticClass:"row"},t._l(t.orgs,function(e){return s("router-link",{key:e.id,staticClass:"col-4 list-group-item list-group-item-action btn btn-success",attrs:{to:{name:"organization",params:{orgId:e.orgId}},tag:"button","active-class":"active"}},[t._v("\n              "+t._s(e.name)+"\n            ")])}),1)]):t._e(),s("form",{staticClass:"col-4 mx-auto"},[s("div",{staticClass:"form-group text-left"},[s("label",{attrs:{for:"name"},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.addOrganization(e)}}},[t._v("Add Organization")]),s("input",{directives:[{name:"model",rawName:"v-model.trim",value:t.orgName,expression:"orgName",modifiers:{trim:!0}}],staticClass:"form-control",attrs:{placeholder:"Organization Name",id:"name"},domProps:{value:t.orgName},on:{input:function(e){e.target.composing||(t.orgName=e.target.value.trim())},blur:function(e){return t.$forceUpdate()}}})]),s("button",{staticClass:"mx-3 btn btn-success",on:{click:function(e){return e.preventDefault(),t.addOrganization(e)}}},[t._v("Add Organization")])])]),s("div",{staticClass:"row my-5"},[0!==t.projects.length?s("div",{staticClass:"col-8 mr-auto"},[s("h5",{staticClass:"text-left"},[t._v("My Projects")]),s("div",{staticClass:"row"},t._l(t.projects,function(e){return s("router-link",{key:e.id,staticClass:"col-4 list-group-item list-group-item-action btn btn-success",attrs:{to:e.orgId+"/"+e.proId,tag:"button","active-class":"active"}},[t._v("\n                "+t._s(e.orgName)+" / "+t._s(e.name)+"\n              ")])}),1)]):t._e()]),s("div",{staticClass:"row my-5"},[0!==t.issues.length?s("div",{staticClass:"col-8 mr-auto"},[s("h5",{staticClass:"text-left"},[t._v("My Issues")]),s("div",{staticClass:"row"},t._l(t.issues,function(e){return s("router-link",{key:e.id,staticClass:"col-4 list-group-item list-group-item-action btn btn-success",attrs:{to:e.orgId+"/"+e.proId+"/"+e.issueId,tag:"button","active-class":"active"}},[t._v("\n                "+t._s(e.orgName)+" / "+t._s(e.proName)+" / "+t._s(e.issueName)+"\n              ")])}),1)]):t._e()]),s("div",{staticClass:"row my-5"},[s("div",{staticClass:"col-8 mr-auto"},[s("h5",{staticClass:"text-left"},[t._v("指派給我的 Issues")]),0!==t.assigneeList.length?s("div",{staticClass:"row"},t._l(t.assigneeList,function(e){return s("router-link",{key:e.id,staticClass:"col-4 list-group-item list-group-item-action btn btn-success",attrs:{to:e.proId+"/"+e.proId+"/"+e.issueId,tag:"button","active-class":"active"}},[t._v("\n                  "+t._s(e.orgName)+" / "+t._s(e.proName)+" / "+t._s(e.assignIssue)+"\n                ")])}),1):s("div",{staticClass:"row my-5"},[s("h4",{staticClass:"mx-auto font-italic"},[t._v("目前尚無資料")])])])])])]:t._e()],2)},n=[],r=(s("7514"),s("bf48")),i=s.n(r),o={name:"dashboard",components:{},data:function(){return{username:"",orgName:"",orgs:[],avatarHash:"",projects:[],issues:[],assigneeList:[]}},created:function(){!1===this.$store.state.user.authed&&this.$router.push({path:"/signin"})},computed:{user:function(){return{authed:this.$store.state.user.authed,email:this.$store.state.user.input.email,id:this.$store.state.user.input.userId}}},mounted:function(){this.showOrg(),this.showUsername(),this.showProject(),this.showIssue(),this.showAssignee()},methods:{showUsername:function(){var t=this,e=i.a.Object.extend("Account"),s=new i.a.Query(e);s.get(t.user.id).then(function(e){return t.avatarHash=t.$md5(e.get("email")),t.username=e.get("username"),e.set("avatarHash",t.avatarHash),e.save()})},showOrg:function(){var t=this,e=i.a.Object.extend("Organization"),s=new i.a.Query(e),a=[];s.equalTo("memberId",t.user.id),s.find().then(function(s){for(var n=function(t){var n={},r=s[t],o=new i.a.Query(e);n.orgId=r.id,o.get(r.id).then(function(t){n.name=t.get("name"),a.push(n)})},r=0;r<s.length;r++)n(r);t.orgs=a})},addOrganization:function(){var t=this;if(""!==t.orgName){var e=i.a.Object.extend("Organization"),s=new e;s.set("name",t.orgName),s.set("memberId",t.$store.state.user.input.userId),s.save().then(function(e){t.orgName="",t.showOrg()},function(t){})}else alert("組織名稱不可空白")},showProject:function(){var t=this,e=[],s=i.a.Object.extend("Organization"),a=new i.a.Query(s);a.equalTo("memberId",t.user.id),a.find().then(function(s){for(var a=0;a<s.length;a++){var n=s[a],r=i.a.Object.extend("Project"),o=new i.a.Query(r);o.equalTo("orgId",n.id),o.find().then(function(s){for(var a=0;a<s.length;a++){var n={},r=s[a];n.orgName=r.get("orgName"),n.name=r.get("name"),n.orgId=r.get("orgId"),n.proId=r.id,e.push(n)}t.projects=e})}})},showIssue:function(){var t=this,e=i.a.Object.extend("Organization"),s=new i.a.Query(e),a=[];s.equalTo("memberId",t.user.id),s.find().then(function(t){for(var e=0;e<t.length;e++){var s=t[e];a.push(s.id)}return a}).then(function(e){var s=[],a=i.a.Object.extend("Project"),n=new i.a.Query(a);n.containedIn("orgId",e),n.find().then(function(t){for(var e=0;e<t.length;e++){var a=t[e];s.push(a.id)}return s}).then(function(e){var s=[],a={},n=i.a.Object.extend("Issue"),r=new i.a.Query(n);r.containedIn("proId",e),r.find().then(function(e){for(var n=0;n<e.length;n++){var r=e[n];a.issueId=r.id,a.orgId=r.get("orgId"),a.proId=r.get("proId"),a.proName=r.get("proName"),a.orgName=r.get("orgName"),a.issueName=r.get("name"),s.push(a),a={}}t.issues=s})})})},showAssignee:function(){var t=this,e=[],s=i.a.Object.extend("Issue"),a=new i.a.Query(s);a.equalTo("assigneeId",t.user.id),a.find().then(function(t){for(var s=0;s<t.length;s++){var a={},n=t[s];a.assignIssue=n.get("name"),a.issueId=n.id,a.orgId=n.get("orgId"),a.proId=n.get("proId"),a.orgName=n.get("orgName"),a.proName=n.get("proName"),e.push(a)}},function(t){}),t.assigneeList=e}},watch:{}},u=o,c=s("2877"),d=Object(c["a"])(u,a,n,!1,null,"309dfb34",null);e["default"]=d.exports}}]);
//# sourceMappingURL=chunk-2d0c14f9.912a9128.js.map